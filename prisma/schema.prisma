generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model User {
  id                String     @id @default(uuid())
  email             String     @unique
  name              String
  username          String     @unique
  submittedResponses Response[]
}

model Response {
  id        String   @id @default(uuid())
  userId    String
  formId    Int
  content   String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
  form      Form     @relation(fields: [formId], references: [id])
}

model Form {
  id                      Int              @id @default(autoincrement())
  userId                  String
  createdBy              String
  createdAt              DateTime         @default(now())
  published              Boolean          @default(false)
  isDeactivated          Boolean          @default(false)
  isArchived             Boolean          @default(false)
  isFavorite             Boolean          @default(false)
  name                   String
  description            String           @default("")
  content                String           @default("[]")
  visits                 Int              @default(0)
  submissions            Int              @default(0)
  maxSubmissions         Int              @default(0)
  shareURL               String           @unique @default(uuid())
  FormSubmissions        FormSubmissions[]
  responses              Response[]        // Added this relation
  allowMultipleSubmissions Boolean         @default(false)
  expiresAt              DateTime?
  lastUpdatedAt          DateTime         @updatedAt

  @@unique([name, userId])
}

model FormSubmissions {
  id            Int      @id @default(autoincrement())
  email         String
  createdAt     DateTime @default(now())
  lastUpdatedAt DateTime @updatedAt
  status        String   @default("draft")
  formId        Int
  form          Form     @relation(fields: [formId], references: [id])
  content       String
  feedback      String   @default("")
}